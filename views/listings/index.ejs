<% layout("layouts/boilerplate") %>
<body>

<div class="filter-list-wrapper">
  <div id="filters">
    <a href="/listings"><div class="filter"><div><i class="fa-solid fa-fire"></i></div><p>Trending</p></div></a>
    <a href="/listings?category=Rooms"><div class="filter"><div><i class="fa-solid fa-bed"></i></div><p>Rooms</p></div></a>
    <a href="/listings?category=Iconic cities"><div class="filter"><div><i class="fa-solid fa-mountain-city"></i></div><p>Iconic cities</p></div></a>
    <a href="/listings?category=Beach"><div class="filter"><div><i class="fa-solid fa-umbrella-beach"></i></div><p>Beach</p></div></a>
    <a href="/listings?category=Lake front"><div class="filter"><div><i class="fa-solid fa-house-flood-water"></i></div><p>Lake front</p></div></a>
    <a href="/listings?category=Camping"><div class="filter"><div><i class="fa-solid fa-campground"></i></div><p>Camping</p></div></a>
    <a href="/listings?category=Farms"><div class="filter"><div><i class="fa-solid fa-tractor"></i></div><p>Farms</p></div></a>
    <a href="/listings?category=Cabin"><div class="filter"><div><i class="fa-solid fa-house"></i></div><p>Cabin</p></div></a>
    <a href="/listings?category=Mountains"><div class="filter"><div><i class="fa-solid fa-mountain"></i></div><p>Mountains</p></div></a>
    <a href="/listings?category=Castles"><div class="filter"><div><i class="fa-brands fa-fort-awesome"></i></div><p>Castles</p></div></a>
    <a href="/listings?category=Arctic"><div class="filter"><div><i class="fa-solid fa-person-skiing"></i></div><p>Arctic</p></div></a>

    <div class="tax-toggle">
      <div class="form-check-reverse form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="switchCheckDefault">
        <label class="form-check-label" for="switchCheckDefault">Total before taxes</label>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Listing Cards -->
<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 container-fluid gx-4 gy-4 mt-3">
  <% allListings.forEach((listing) => { 
       // ✅ Step 1: Define a safe image URL fallback
       let imgUrl;
       if (listing.images && listing.images.length > 0 && listing.images[0].url) {
         imgUrl = listing.images[0].url;
       } else if (listing.image && listing.image.url) {
         imgUrl = listing.image.url;
       } else {
         // ✅ Default placeholder image (make sure this file exists in /public/images)
         imgUrl = '/images/default-listing.jpg';
       }
  %>

    <!-- ✅ Step 2: Render Listing Card -->
    <a href="/listings/<%= listing._id %>" class="listing-link">
      <div class="card col listing-card">
        <img 
           src="<%= (imgUrl && typeof imgUrl === 'string' && imgUrl.includes('/upload'))
           ? imgUrl.replace('/upload', '/upload/w_1200,h_800,c_limit,q_auto,f_auto')
           : '/images/default-listing.jpg' %>"
           class="card-img-top"
           alt="listing_image"
           style="height:20rem"
           loading="lazy"
/>

        <div class="card-img-overlay">
          <span class="badge rounded-pill text-bg-light">Guest favourite</span>
        </div>
        <p class="card-text">
          <b><%= listing.title %></b><br>
          <span class="price" data-base="<%= listing.price %>">
            &#8377;<%= listing.price.toLocaleString("en-IN") %>
          </span> / night
        </p>
      </div>
    </a>

  <% }) %>
</div>

</body>
